

<div align="center">
<h1>Guardian</h1>
<p>åŸºäº Rust çš„ç”Ÿäº§çº§åå°ç®¡ç†è®¤è¯ç³»ç»Ÿ</p>
  <p>
  <a href="https://github.com/cherish-ltt/Guardian/blob/main/LICENSE">
    <img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="license"/>
  </a>
  <a href="https://www.rust-lang.org">
    <img src="https://img.shields.io/badge/rust-1.92.0+-orange.svg" alt="license"/>
  </a>
  <a href="https://img.shields.io/badge/version-v1.0-blue.svg">
    <img src="https://img.shields.io/badge/version-v0.1-blue.svg" alt="license"/>
  </a>
  <a href="https://img.shields.io/badge/status-stable-green.svg">
    <img src="https://img.shields.io/badge/status-stable-green.svg" alt="license"/>
  </a>
  </p>
</div>

## ğŸ“– é¡¹ç›®ç®€ä»‹

  Guardian æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€é«˜æ€§èƒ½çš„è®¤è¯æˆæƒç³»ç»Ÿï¼Œä¸“ä¸ºç°ä»£ Web åº”ç”¨ç¨‹åºè®¾è®¡ã€‚å®ƒæä¾›äº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯ã€æƒé™ç®¡ç†å’Œæ“ä½œå®¡è®¡åŠŸèƒ½ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œç¡®ä¿é«˜å¯ç”¨æ€§å’Œæ˜“ç»´æŠ¤æ€§ã€‚

æ¨èå‰ç«¯é¡µé¢ï¼š[Guardian-Website](https://github.com/cherish-ltt/Guardian-Website) 

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ” å®‰å…¨è®¤è¯
- **Argon2 å¯†ç åŠ å¯†** - ä¸šç•Œæœ€å®‰å…¨çš„å¯†ç å“ˆå¸Œç®—æ³•
- **åŒå› ç´ è®¤è¯ (2FA)** - æ”¯æŒ TOTP åè®®ï¼ˆé¢„ç•™æ¥å£ï¼‰
- **è´¦æˆ·é”å®šæœºåˆ¶** - 5æ¬¡ç™»å½•å¤±è´¥é”å®š15åˆ†é’Ÿ
- **JWT ä»¤ç‰Œç®¡ç†**
  - Access Token: 15åˆ†é’Ÿæœ‰æ•ˆæœŸ
  - Refresh Token: 7å¤©æœ‰æ•ˆæœŸ
  - ä»¤ç‰Œé»‘åå•æœºåˆ¶é˜²æ­¢é‡æ”¾æ”»å‡»

### ğŸ¯ æƒé™æ§åˆ¶ (RBAC)
- **ç»†ç²’åº¦æƒé™** - API/èœå•/æŒ‰é’®ä¸‰çº§æƒé™
- **è§’è‰²-æƒé™ä½“ç³»** - çµæ´»çš„æƒé™åˆ†é…
- **è¶…çº§ç®¡ç†å‘˜** - è·³è¿‡æƒé™æ£€æŸ¥ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™
- **ç³»ç»Ÿå†…ç½®è§’è‰²/æƒé™** - ä¸å¯åˆ é™¤ï¼Œä¿è¯ç³»ç»Ÿå®‰å…¨

### ğŸ“Š å®¡è®¡æ—¥å¿—
- **å¼‚æ­¥æ‰¹é‡å†™å…¥** - æ¯3ç§’æ‰¹é‡å†™å…¥ï¼Œæˆ–é˜Ÿåˆ—æ»¡10æ¡ç«‹å³è§¦å‘
- **å®Œæ•´çš„æ“ä½œè®°å½•** - ç”¨æˆ·ä¿¡æ¯ã€è¯·æ±‚å‚æ•°ã€å“åº”ç»“æœ
- **æ€§èƒ½ç›‘æ§** - è®°å½•è¯·æ±‚è€—æ—¶
- **IPå’ŒUser-Agent** - å®Œæ•´çš„å®¢æˆ·ç«¯ä¿¡æ¯

### ğŸš€ é«˜æ€§èƒ½
- **å¼‚æ­¥éé˜»å¡IO** - åŸºäº Tokio è¿è¡Œæ—¶
- **SeaORM æ•°æ®åº“æŠ½è±¡** - ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æœŸæ£€æŸ¥
- **è¿æ¥æ± ä¼˜åŒ–** - é«˜æ•ˆçš„æ•°æ®åº“è¿æ¥ç®¡ç†
- **å†…å­˜ä¼˜åŒ–** - æ—¥å¿—ç¼“å†²æ± å¤§å°é™åˆ¶

## ğŸ›  æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|--------|------|
| **Rust** | 2024 Edition | ç³»ç»Ÿè¯­è¨€ |
| **Axum** | 0.8 | Web æ¡†æ¶ |
| **SeaORM** | 0.12 | ORM æ¡†æ¶ |
| **PostgreSQL** | 17 | æ•°æ®åº“ |
| **Tokio** | 1.x | å¼‚æ­¥è¿è¡Œæ—¶ |
| **JWT** | 9.0 | è®¤è¯ä»¤ç‰Œ |
| **Chrono** | 0.4 | æ—¶é—´å¤„ç† |
| **Serde** | 1.x | åºåˆ—åŒ–/ååºåˆ—åŒ– |

## ğŸ“¦ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

| è¡¨å | è¯´æ˜ | ä¸»è¦å­—æ®µ |
|--------|------|----------|
| `guardian_admins` | ç®¡ç†å‘˜è¡¨ | id(UUID-V7), username, password_hash, two_fa_secret, is_super_admin, status, last_login_at, login_attempts, locked_until |
| `guardian_roles` | è§’è‰²è¡¨ | id(UUID-V7), code, name, description, is_system |
| `guardian_permissions` | æƒé™è¡¨ | id(UUID-V7), code, name, description, resource_type, http_method, resource_path, parent_id(UUID-V7), sort_order, is_system |
| `guardian_admin_roles` | ç®¡ç†å‘˜-è§’è‰²å…³è” | admin_id(UUID-V7), role_id(UUID-V7) |
| `guardian_role_permissions` | è§’è‰²-æƒé™å…³è” | role_id(UUID-V7), permission_id(UUID-V7) |
| `guardian_token_blacklist` | ä»¤ç‰Œé»‘åå• | id(UUID-V7), token_id, expires_at |
| `guardian_audit_logs` | å®¡è®¡æ—¥å¿—è¡¨ | id(UUID-V7), trace_id, admin_id(UUID-V7), username, action, resource, method, params, result, status_code, ip_address, user_agent, duration_ms |

### è®¾è®¡ç‰¹ç‚¹
- âœ… æ— å¤–é”®çº¦æŸ - åªé€šè¿‡é€»è¾‘å…³è”ï¼Œæé«˜çµæ´»æ€§
- âœ… å®Œæ•´çš„ç´¢å¼•è®¾è®¡ - ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- âœ… UUIDv7 ä¸»é”® - å…¨å±€å”¯ä¸€ä¸”æœ‰åºï¼Œé¿å… ID ç¢°æ’
- âœ… è‡ªåŠ¨è§¦å‘å™¨ - æ•°æ®åº“è‡ªåŠ¨ç»´æŠ¤ created_at å’Œ updated_at
- âœ… æ—¶é—´æˆ³å­—æ®µ - TIMESTAMPTZ ç±»å‹ï¼Œæ”¯æŒæ—¶åŒº
- âœ… çŠ¶æ€å­—æ®µ - è½¯åˆ é™¤ã€ç¦ç”¨ç­‰åŠŸèƒ½

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

#### å¿…éœ€è½¯ä»¶
- **Rust 1.92+** - ä½¿ç”¨ rustup å®‰è£…ï¼š
  ```bash
  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
  source $HOME/.cargo/env
  ```
  éªŒè¯å®‰è£…ï¼š`rustc --version` å’Œ `cargo --version`

- **PostgreSQL 17+** - æ•°æ®åº“æœåŠ¡ï¼š
  - **macOS** (ä½¿ç”¨ Homebrew):
    ```bash
    brew install postgresql@17
    brew services start postgresql@17
    ```
  - **Linux (RHEL/CentOS)**:
    ```bash
    # æ·»åŠ  PostgreSQL 17 ä»“åº“
    sudo dnf install https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm
    sudo dnf install postgresql17-server
    sudo /usr/pgsql-17/bin/postgresql-17-setup initdb
    sudo systemctl start postgresql-17
    ```
  - **Ubuntu/Debian**:
    ```bash
    sudo apt update
    sudo apt install postgresql-17
    sudo systemctl start postgresql
    ```
  - **éªŒè¯å®‰è£…**ï¼š`psql --version` åº”æ˜¾ç¤º `psql (PostgreSQL) 17.x`

- **Python 3.8+** - ç”¨äºè¿è¡Œè„šæœ¬å·¥å…·ï¼ˆsystem_monitor.py, init_db.pyï¼‰

#### Python ä¾èµ–ï¼ˆç”¨äºè„šæœ¬ï¼‰
```bash
pip install asyncpg psutil croniter psycopg2
```

> ğŸ“¦ Python åŒ…è¯´æ˜ï¼š
> - `asyncpg` - å¼‚æ­¥ PostgreSQL å®¢æˆ·ç«¯ï¼ˆsystem_monitor.py ä½¿ç”¨ï¼‰
> - `psutil` - ç³»ç»Ÿä¿¡æ¯æ”¶é›†ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œï¼‰
> - `croniter` - Cron è¡¨è¾¾å¼è§£æï¼ˆå®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼‰
> - `psycopg2` - åŒæ­¥ PostgreSQL å®¢æˆ·ç«¯ï¼ˆinit_db.py ä½¿ç”¨ï¼‰

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/cherry-llt/Guardian.git
cd Guardian
```

### 2. é…ç½®æ•°æ®åº“

#### æ–¹æ³• Aï¼šä½¿ç”¨åˆå§‹åŒ–è„šæœ¬ï¼ˆæ— é»˜è®¤è´¦å·ï¼‰
åˆ›å»º PostgreSQL æ•°æ®åº“å¹¶è¿è¡Œåˆå§‹åŒ–è„šæœ¬ï¼š

```bash
# ç¼–è¾‘ scripts/init_db.py ä¸­çš„æ•°æ®åº“é…ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
python3 scripts/init_db.py
```

è¿™ä¼šåˆ›å»ºæ•°æ®åº“ã€æ‰€æœ‰è¡¨å’Œåˆå§‹æ•°æ®ã€‚

#### æ–¹æ³• Bï¼šå¯¼å…¥ public.sqlï¼ˆæ¨èï¼Œæœ‰é»˜è®¤è´¦å·ï¼‰
å¦‚æœå·²æœ‰ PostgreSQL æ•°æ®åº“ï¼Œç›´æ¥å¯¼å…¥ SQL æ–‡ä»¶ï¼š

```bash
# ç¡®ä¿æ•°æ®åº“å·²åˆ›å»ºï¼ˆå¦‚æœªåˆ›å»ºï¼Œè¯·å…ˆè¿è¡Œ init_db.py æˆ–æ‰‹åŠ¨åˆ›å»ºï¼‰
psql -h 127.0.0.1 -p 5432 -U postgres -d guardian_auth -f scripts/public.sql
```

#### é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·

ä½¿ç”¨ `public.sql` å¯¼å…¥åï¼Œç³»ç»ŸåŒ…å«ä¸€ä¸ªé»˜è®¤è¶…çº§ç®¡ç†å‘˜ï¼š

- **ç”¨æˆ·å**ï¼š`guardian`
- **å¯†ç **ï¼š`123456`
- **è§’è‰²**ï¼šè¶…çº§ç®¡ç†å‘˜ï¼ˆSuperAdminï¼‰
- **æƒé™**ï¼šæ‹¥æœ‰æ‰€æœ‰ç³»ç»Ÿæƒé™

> âš ï¸ **å®‰å…¨æé†’**ï¼šç”Ÿäº§ç¯å¢ƒè¯·ç«‹å³ç™»å½•å¹¶ä¿®æ”¹é»˜è®¤å¯†ç ï¼

> ğŸ’¡ **æç¤º**ï¼š`public.sql` æ–‡ä»¶åŒ…å«å®Œæ•´çš„æ•°æ®åº“æ¶æ„å’Œåˆå§‹æ•°æ®ï¼ŒåŒ…æ‹¬ç³»ç»Ÿå†…ç½®è§’è‰²ã€æƒé™å’Œé»˜è®¤ç®¡ç†å‘˜ã€‚

### 3. é…ç½®ç¯å¢ƒå˜é‡

ä½¿ç”¨ `.env-public` ä½œä¸ºæ¨¡æ¿åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cp .env-public .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

#### æ•°æ®åº“é…ç½®
```env
DATABASE_URL=postgresql://postgres:123456@127.0.0.1:5432/guardian_auth
```
- `DATABASE_URL`ï¼šPostgreSQL è¿æ¥å­—ç¬¦ä¸²
- æ ¼å¼ï¼š`postgresql://ç”¨æˆ·å:å¯†ç @ä¸»æœº:ç«¯å£/æ•°æ®åº“å`

#### JWT é…ç½®
```env
JWT_SECRET=your-super-secret-jwt-key-min-32-chars
```
- `JWT_SECRET`ï¼šJWT ä»¤ç‰Œç­¾åå¯†é’¥
- **âš ï¸ ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨å¼ºéšæœºå¯†é’¥ï¼ˆè‡³å°‘ 32 å­—ç¬¦ï¼‰**
- ç”¨äºç­¾å Access Token å’Œ Refresh Token

#### åŠ å¯†é…ç½®
```env
ENCRYPTION_KEY=32-byte-encryption-key-for-chacha20
```
- `ENCRYPTION_KEY`ï¼šChaCha20 åŠ å¯†å¯†é’¥ï¼ˆç”¨äº 2FA secret å­˜å‚¨ï¼‰
- **âš ï¸ ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ 32 å­—èŠ‚å¼ºå¯†é’¥**
- ç”¨äºåŠ å¯†/è§£å¯† TOTP secret

#### æ—¥å¿—ç¼“å†²é…ç½®
```env
LOG_BUFFER_SIZE=1000
LOG_BATCH_SIZE=10
LOG_FLUSH_INTERVAL_SECS=3
```
- `LOG_BUFFER_SIZE`ï¼šå®¡è®¡æ—¥å¿—ç¼“å†²æ± å¤§å°
- `LOG_BATCH_SIZE`ï¼šæ¯æ¬¡æ‰¹é‡å†™å…¥çš„æ—¥å¿—æ•°é‡
- `LOG_FLUSH_INTERVAL_SECS`ï¼šæ‰¹é‡å†™å…¥é—´éš”ï¼ˆç§’ï¼‰

#### é€Ÿç‡é™åˆ¶
```env
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_WINDOW_SECS=60
```
- `RATE_LIMIT_MAX_REQUESTS`ï¼šæ—¶é—´çª—å£å†…æœ€å¤§è¯·æ±‚æ•°
- `RATE_LIMIT_WINDOW_SECS`ï¼šé€Ÿç‡é™åˆ¶æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
- é˜²æ­¢æš´åŠ›æ”»å‡»å’Œ API æ»¥ç”¨

#### æœåŠ¡å™¨é…ç½®
```env
SERVER_HOST=0.0.0.0
SERVER_PORT=6123
```
- `SERVER_HOST`ï¼šæœåŠ¡å™¨ç›‘å¬åœ°å€ï¼ˆ`0.0.0.0` ç›‘å¬æ‰€æœ‰æ¥å£ï¼‰
- `SERVER_PORT`ï¼šæœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤ 6123ï¼‰

#### Python è„šæœ¬ç¯å¢ƒå˜é‡ï¼ˆsystem_monitor.pyï¼‰

```bash
DB_HOST=127.0.0.1
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=123456
DB_NAME=guardian_auth
```

> ğŸ’¡ **æç¤º**ï¼š`.env-public` æ–‡ä»¶åŒ…å«æ‰€æœ‰ç¯å¢ƒå˜é‡çš„ç¤ºä¾‹é…ç½®å’Œè¯¦ç»†æ³¨é‡Šã€‚ç”Ÿäº§ç¯å¢ƒè¯·å¤åˆ¶ä¸º `.env` å¹¶ä¿®æ”¹æ•æ„Ÿä¿¡æ¯ã€‚

### 3.5 ç³»ç»Ÿç›‘æ§è„šæœ¬ï¼ˆå¯é€‰ï¼‰

`scripts/system_monitor.py` æ˜¯ä¸€ä¸ªç³»ç»Ÿæ€§èƒ½ç›‘æ§è„šæœ¬ï¼Œè‡ªåŠ¨æ”¶é›†ç³»ç»ŸæŒ‡æ ‡å¹¶å­˜å‚¨åˆ°æ•°æ®åº“ã€‚

#### åŠŸèƒ½ç‰¹æ€§
- **ç³»ç»ŸæŒ‡æ ‡æ”¶é›†**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œä½¿ç”¨æƒ…å†µ
- **Cron å®šæ—¶è°ƒåº¦**ï¼šé»˜è®¤æ¯ 5 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼ˆå¯é…ç½®ï¼‰
- **å¼‚æ­¥å†™å…¥**ï¼šä½¿ç”¨ asyncpg é«˜æ•ˆå†™å…¥æ•°æ®åº“
- **ä¼˜é›…å…³é—­**ï¼šæ”¯æŒ SIGINT/SIGTERM ä¿¡å·

#### è¿è¡Œæ–¹å¼

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆæ¯ 5 åˆ†é’Ÿï¼‰
python3 scripts/system_monitor.py

# æˆ–è‡ªå®šä¹‰ cron è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚æ¯ 10 åˆ†é’Ÿï¼‰
CRON="*/10 * * * *" python3 scripts/system_monitor.py
```

#### ç¯å¢ƒå˜é‡é…ç½®

```bash
export DB_HOST=127.0.0.1
export DB_PORT=5432
export DB_USER=postgres
export DB_PASSWORD=123456
export DB_NAME=guardian_auth
```

#### Cron è¡¨è¾¾å¼ç¤ºä¾‹

- `*/5 * * * *` - æ¯ 5 åˆ†é’Ÿè¿è¡Œï¼ˆé»˜è®¤ï¼‰
- `*/10 * * * *` - æ¯ 10 åˆ†é’Ÿè¿è¡Œ
- `0 */2 * * *` - æ¯ 2 å°æ—¶è¿è¡Œ
- `0 0 * * *` - æ¯å¤©åˆå¤œè¿è¡Œ

#### ç›‘æ§æ•°æ®

ç›‘æ§æ•°æ®å­˜å‚¨åœ¨ `guardian_systeminfo` è¡¨ä¸­ï¼Œå¯é€šè¿‡ API ç«¯ç‚¹æŸ¥è¯¢ï¼š

```
GET /guardian-auth/v1/systeminfo?page=1&limit=10
```

è¿”å›æœ€è¿‘çš„ç³»ç»Ÿç›‘æ§è®°å½•ï¼ŒåŒ…æ‹¬ï¼š
- CPU æ ¸å¿ƒæ•°å’Œä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨é‡/æ€»é‡
- ç£ç›˜ä½¿ç”¨é‡/æ€»é‡
- ç½‘ç»œä¸Šä¼ /ä¸‹è½½é‡
- è®°å½•æ—¶é—´æˆ³

> ğŸ’¡ **æç¤º**ï¼šsystem_monitor.py æ˜¯å¯é€‰çš„ï¼Œä½†æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œä»¥ç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶å†µã€‚

### 4. åˆ›å»ºè¶…çº§ç®¡ç†å‘˜ï¼ˆå¯é€‰ï¼‰

å¦‚æœªä½¿ç”¨ `public.sql` å¯¼å…¥ï¼Œå¯é€šè¿‡ API æˆ–ç›´æ¥æ’å…¥æ•°æ®åº“åˆ›å»ºæ–°çš„è¶…çº§ç®¡ç†å‘˜è´¦æˆ·ã€‚

å‚è€ƒ `public.sql` ä¸­çš„é»˜è®¤ç®¡ç†å‘˜é…ç½®ä½œä¸ºç¤ºä¾‹ã€‚

### 5. æ„å»ºå¹¶è¿è¡Œ

#### å¼€å‘æ¨¡å¼
```bash
cargo run
```
æœåŠ¡å™¨å°†åœ¨ `http://localhost:6123` å¯åŠ¨ã€‚

#### ç”Ÿäº§æ¨¡å¼
```bash
# ç¼–è¯‘å‘å¸ƒç‰ˆæœ¬
cargo build --release

# è¿è¡Œ
./target/release/Guardian
```

#### éªŒè¯æœåŠ¡
```bash
# æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
curl http://localhost:6123/health

# æµ‹è¯•é»˜è®¤ç®¡ç†å‘˜ç™»å½•
curl -X POST http://localhost:6123/guardian-auth/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"guardian","password":"123456"}'
```

æˆåŠŸç™»å½•åº”è¿”å›ï¼š
```json
{
  "code": 200,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 900
  }
}
```

#### åå°è¿è¡Œï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

ä½¿ç”¨ systemdã€supervisor æˆ– pm2 ç®¡ç†æœåŠ¡è¿›ç¨‹ï¼š

**systemd ç¤ºä¾‹** (`/etc/systemd/system/guardian.service`):

```ini
[Unit]
Description=Guardian Auth Service
After=network.target

[Service]
Type=simple
User=guardian
WorkingDirectory=/opt/guardian
ExecStart=/opt/guardian/target/release/Guardian
Restart=on-failure
RestartSec=10s

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl enable guardian
sudo systemctl start guardian
sudo systemctl status guardian
```

### 6.[Guardian-Website](https://github.com/cherish-ltt/Guardian-Website)ï¼ˆå¯é€‰ï¼‰

Guardian-Website æ˜¯åŸºäº **Next.js 16** + **React 19** + **Tailwind CSS 4** + **shadcn/ui** æ„å»ºçš„ç°ä»£åŒ–å‰ç«¯ç•Œé¢ï¼Œä¸º Guardian åç«¯æä¾›å®Œæ•´çš„ Web ç®¡ç†ç•Œé¢ã€‚

#### å‰ç«¯æ ¸å¿ƒç‰¹æ€§

- ğŸ” **å®Œæ•´çš„è®¤è¯æµç¨‹** - ç™»å½•ã€2FAã€JWT ä»¤ç‰Œç®¡ç†
- ğŸ¨ **ç°ä»£åŒ– UI è®¾è®¡** - shadcn/ui ç»„ä»¶åº“ï¼Œæ”¯æŒæ·±è‰²/æµ…è‰²ä¸»é¢˜
- ğŸ“± **å“åº”å¼å¸ƒå±€** - å®Œç¾é€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- ğŸ”„ **å®Œå–„çš„ API é›†æˆ** - è‡ªåŠ¨ Token åˆ·æ–°å’Œé”™è¯¯å¤„ç†
- ğŸš€ **é«˜æ€§èƒ½æ¶æ„** - React Server Componentsï¼ŒTurbopack æ„å»ºä¼˜åŒ–
- ğŸŒ **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰

#### å¿«é€Ÿå¯åŠ¨å‰ç«¯

```bash
# å…‹éš†å‰ç«¯ä»“åº“
git clone https://github.com/cherish-ltt/Guardian-Website.git
cd Guardian-Website

# å®‰è£…ä¾èµ–ï¼ˆéœ€è¦ pnpmï¼‰
pnpm install

# é…ç½® API åœ°å€
echo 'NEXT_PUBLIC_API_BASE_URL=http://localhost:6123/guardian-auth/v1' > .env.local

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

å‰ç«¯å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

#### å‰åç«¯é›†æˆ

- **API è¿æ¥**ï¼šé€šè¿‡ `NEXT_PUBLIC_API_BASE_URL` é…ç½®
- **è®¤è¯æ–¹å¼**ï¼šJWT Bearer Token å­˜å‚¨
- **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€çš„ code/msg/data å“åº”æ ¼å¼
- **å®Œæ•´æ–‡æ¡£**ï¼šå‰ç«¯åŒ…å«å®Œæ•´çš„ API v1.0 æ–‡æ¡£

> ğŸ’¡ **æç¤º**ï¼šGuardian-Website æ˜¯**å¯é€‰çš„**ï¼ŒGuardian åç«¯å¯ç‹¬ç«‹ä½œä¸º REST API ä½¿ç”¨ã€‚å‰ç«¯å¯ä½œä¸ºå‚è€ƒå®ç°æˆ–ç›´æ¥ä½¿ç”¨ã€‚

## ğŸ“š API æ–‡æ¡£

å®Œæ•´çš„ API æ–‡æ¡£è¯·å‚è€ƒï¼š

~~[public-docs/api-v1.0.md](https://github.com/cherish-ltt/Guardian/blob/main/public-docs/api-v1.0.md)~~

[public-docs/api-v1.1.md](https://github.com/cherish-ltt/Guardian/blob/main/public-docs/api-v1.1.md)

### API æ¦‚è§ˆ

#### è®¤è¯æ¥å£
- `POST /guardian-auth/v1/auth/login` - ç™»å½•
- `POST /guardian-auth/v1/auth/refresh` - åˆ·æ–°ä»¤ç‰Œ
- `POST /guardian-auth/v1/auth/logout` - ç™»å‡ºï¼ˆéœ€è®¤è¯ï¼‰
- `POST /guardian-auth/v1/auth/2fa/setup` - è®¾ç½®2FAï¼ˆéœ€è®¤è¯ï¼‰
- `POST /guardian-auth/v1/auth/2fa/verify` - éªŒè¯2FAï¼ˆéœ€è®¤è¯ï¼‰

#### ç®¡ç†å‘˜æ¥å£
- `POST /guardian-auth/v1/admins` - åˆ›å»ºç®¡ç†å‘˜ï¼ˆéœ€è®¤è¯ï¼‰
- `GET /guardian-auth/v1/admins` - æŸ¥è¯¢ç®¡ç†å‘˜åˆ—è¡¨ï¼ˆéœ€è®¤è¯ï¼‰
- `GET /guardian-auth/v1/admins/:id` - è·å–ç®¡ç†å‘˜è¯¦æƒ…ï¼ˆéœ€è®¤è¯ï¼‰
- `PUT /guardian-auth/v1/admins/:id` - æ›´æ–°ç®¡ç†å‘˜ï¼ˆéœ€è®¤è¯ï¼‰
- `DELETE /guardian-auth/v1/admins/:id` - åˆ é™¤ç®¡ç†å‘˜ï¼ˆéœ€è®¤è¯ï¼‰
- `POST /guardian-auth/v1/admins/:id/change-password` - ä¿®æ”¹å¯†ç ï¼ˆéœ€è®¤è¯ï¼‰

#### è§’è‰²æ¥å£
- `POST /guardian-auth/v1/roles` - åˆ›å»ºè§’è‰²ï¼ˆéœ€è®¤è¯ï¼‰
- `GET /guardian-auth/v1/roles` - æŸ¥è¯¢è§’è‰²åˆ—è¡¨ï¼ˆéœ€è®¤è¯ï¼‰
- `GET /guardian-auth/v1/roles/:id` - è·å–è§’è‰²è¯¦æƒ…ï¼ˆéœ€è®¤è¯ï¼‰
- `PUT /guardian-auth/v1/roles/:id` - æ›´æ–°è§’è‰²ï¼ˆéœ€è®¤è¯ï¼‰
- `DELETE /guardian-auth/v1/roles/:id` - åˆ é™¤è§’è‰²ï¼ˆéœ€è®¤è¯ï¼‰
- `POST /guardian-auth/v1/roles/:id/permissions` - åˆ†é…æƒé™ï¼ˆéœ€è®¤è¯ï¼‰

#### æƒé™æ¥å£
- `GET /guardian-auth/v1/permissions/tree` - è·å–æƒé™æ ‘ï¼ˆéœ€è®¤è¯ï¼‰
- `GET /guardian-auth/v1/permissions` - æŸ¥è¯¢æƒé™åˆ—è¡¨ï¼ˆéœ€è®¤è¯ï¼‰
- `POST /guardian-auth/v1/permissions` - åˆ›å»ºæƒé™ï¼ˆéœ€è®¤è¯ï¼‰
- `PUT /guardian-auth/v1/permissions/:id` - æ›´æ–°æƒé™ï¼ˆéœ€è®¤è¯ï¼‰
- `DELETE /guardian-auth/v1/permissions/:id` - åˆ é™¤æƒé™ï¼ˆéœ€è®¤è¯ï¼‰

## ğŸ“– ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰ API å“åº”éµå¾ªç»Ÿä¸€æ ¼å¼ï¼š

```json
{
  "code": 200,           // ä¸šåŠ¡çŠ¶æ€ç ï¼Œ200è¡¨ç¤ºæˆåŠŸ
  "msg": "æ“ä½œæˆåŠŸ",     // æ¶ˆæ¯æè¿°ï¼Œå¯ä¸ºnull
  "data": { ... },       // å“åº”æ•°æ®ï¼ŒæˆåŠŸæ—¶åŒ…å«
  "timestamp": 1700000000000  // æ—¶é—´æˆ³ï¼ˆæŸäº›å“åº”åŒ…å«ï¼‰
}
```

### çŠ¶æ€ç è¯´æ˜

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸ |
| 1000 | é€šç”¨è¯·æ±‚å¤±è´¥ |
| 1001 | æœªçŸ¥é”™è¯¯ |
| 17000 | ç³»ç»Ÿå†…éƒ¨é”™è¯¯ |
| 17001 | å‚æ•°éªŒè¯å¤±è´¥ |
| 17002 | è®¤è¯å¤±è´¥ |
| 17003 | ä»¤ç‰Œè¿‡æœŸ |
| 17004 | æƒé™ä¸è¶³ |
| 17005 | èµ„æºä¸å­˜åœ¨ |
| 17006 | è¯·æ±‚é¢‘ç‡è¿‡é«˜ |
| 17007 | 2FAéªŒè¯å¤±è´¥ |
| 17008 | æ— æ•ˆçš„2FAéªŒè¯ç  |
| 17009 | æœªå¯ç”¨2FA |
| 17010 | å·²å¯ç”¨2FA |

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### å¯†ç å®‰å…¨
- âœ… Argon2 å“ˆå¸ŒåŠ å¯†å­˜å‚¨
- âœ… å¯†ç å¼ºåº¦è¦æ±‚
- âœ… ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶ï¼ˆ5æ¬¡ï¼‰
- âœ… è‡ªåŠ¨é”å®šæœºåˆ¶ï¼ˆ15åˆ†é’Ÿï¼‰
- âœ… å¯†ç ä¿®æ”¹éœ€éªŒè¯æ—§å¯†ç 

### ä»¤ç‰Œå®‰å…¨
- âœ… JWT ç­¾åéªŒè¯
- âœ… Access Token çŸ­æœŸæœ‰æ•ˆï¼ˆ15åˆ†é’Ÿï¼‰
- âœ… Refresh Token é•¿æœŸæœ‰æ•ˆï¼ˆ7å¤©ï¼‰
- âœ… ä»¤ç‰Œé»‘åå•é˜²æ­¢é‡æ”¾æ”»å‡»
- âœ… ä»¤ç‰Œè‡ªåŠ¨åˆ·æ–°æœºåˆ¶

### è®¿é—®æ§åˆ¶
- âœ… åŸºäº RBAC çš„æƒé™æ§åˆ¶
- âœ… è¶…çº§ç®¡ç†å‘˜è·³è¿‡æƒé™æ£€æŸ¥
- âœ… ç»†ç²’åº¦æƒé™ï¼ˆAPI/èœå•/æŒ‰é’®ï¼‰
- âœ… IP çº§é™è®°å½•ï¼ˆå®¡è®¡æ—¥å¿—ï¼‰
- âœ… æ“ä½œæ—¶é—´æˆ³è®°å½•

## ğŸ“Š å®¡è®¡æ—¥å¿—

å®¡è®¡æ—¥å¿—è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
- **è¿½è¸ªID** - å…³è”åŒä¸€è¯·æ±‚çš„å¤šä¸ªæ“ä½œ
- **ç®¡ç†å‘˜ä¿¡æ¯** - IDã€ç”¨æˆ·å
- **æ“ä½œç±»å‹** - login/logout/create/update/delete
- **èµ„æºä¿¡æ¯** - æ“ä½œçš„èµ„æºè·¯å¾„
- **HTTP æ–¹æ³•** - GET/POST/PUT/DELETE
- **è¯·æ±‚å‚æ•°** - JSONB æ ¼å¼å­˜å‚¨
- **å“åº”ç»“æœ** - JSONB æ ¼å¼å­˜å‚¨
- **çŠ¶æ€ç ** - HTTP çŠ¶æ€ç 
- **IP åœ°å€** - å®¢æˆ·ç«¯ IP
- **User-Agent** - å®¢æˆ·ç«¯æ ‡è¯†
- **è€—æ—¶** - è¯·æ±‚å¤„ç†æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰

## ğŸ— é¡¹ç›®æ¶æ„

```
Guardian/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controller/        # æ§åˆ¶å™¨å±‚ - å¤„ç†HTTPè¯·æ±‚
â”‚   â”œâ”€â”€ service/           # ä¸šåŠ¡é€»è¾‘å±‚ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ entities/          # æ•°æ®æ¨¡å‹å±‚ - SeaORMå®ä½“
â”‚   â”œâ”€â”€ dto/               # æ•°æ®ä¼ è¾“å¯¹è±¡ - è¯·æ±‚/å“åº”ç»“æ„
â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶å±‚ - è®¤è¯ã€å®¡è®¡ç­‰
â”‚   â”œâ”€â”€ utils/             # å·¥å…·ç±» - åŠ å¯†ã€JWTç­‰
â”‚   â”œâ”€â”€ response/          # å“åº”å°è£… - ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”œâ”€â”€ router.rs          # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ error.rs           # é”™è¯¯å®šä¹‰
â”‚   â””â”€â”€ main.rs            # ç¨‹åºå…¥å£
â”œâ”€â”€ scripts/               # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ init_db.py         # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ system_monitor.py  # ç³»ç»Ÿç›‘æ§è„šæœ¬ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ public.sql         # æ•°æ®åº“å¯¼å…¥æ–‡ä»¶ï¼ˆåŒ…å«é»˜è®¤ç®¡ç†å‘˜ï¼‰
â”œâ”€â”€ design-docs/           # è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ public-docs/       # å…¬å¼€æ–‡æ¡£
â”‚       â””â”€â”€ api-v1.0.md    # APIè¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ Cargo.toml             # é¡¹ç›®é…ç½®
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜
```

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test auth_service

# å¸¦è¾“å‡ºæ˜¾ç¤ºæµ‹è¯•
cargo test -- --nocapture
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ª Rust å®˜æ–¹é£æ ¼æŒ‡å—
- ä½¿ç”¨ `cargo fmt` æ ¼å¼åŒ–ä»£ç 
- ä½¿ç”¨ `cargo clippy` æ£€æŸ¥ä»£ç 
- æ·»åŠ å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“œ License

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](https://github.com/cherish-ltt/Guardian/blob/main/LICENSE) æ–‡ä»¶ã€‚

## ğŸ‘¥ ä½œè€…

Guardian Team - @opencode - <opencode@opencode.ai>

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æœ¬é¡¹ç›®ä¸­æ‰€ä½¿ç”¨çš„æ‰€æœ‰å¼€æºé¡¹ç›®å’Œcrates.ioåº“

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ªStarâ­ï¸

------

<div align="center">  
  <p>Built with â¤ï¸ by the Guardian team</p>

